{"version":3,"sources":["peer-puppet.js","App.js","reportWebVitals.js","index.js"],"names":["window","require","desktopCapturer","ipcRenderer","pc","RTCPeerConnection","getScreenStream","a","getSources","types","sources","Promise","resolve","reject","navigator","webkitGetUserMedia","audio","video","mandatory","chromeMediaSource","chromeMediaSourceId","id","maxWidth","screen","width","maxHeight","height","stream","err","console","error","createAnswer","offer","screenStream","addStream","setRemoteDescription","setLocalDescription","log","JSON","stringify","localDescription","ondatachannel","e","chanel","onmessage","data","type","send","onicecandidate","candidate","on","addIceCandidate","candidates","push","remoteDescription","i","length","RTCIceCandidate","answer","sdp","Menu","MenuItem","App","useState","remoteCode","setRemoteCode","localCoade","setLocalCode","controlText","setControlText","login","invoke","code","useEffect","handleControlState","removeListener","name","text","className","onContextMenu","preventDefault","menu","append","label","role","popup","handleContextmenu","value","onChange","target","onClick","startControl","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"uOAIA,EAAwCA,OAAOC,QAAQ,YAA/CC,EAAR,EAAQA,gBAAgBC,EAAxB,EAAwBA,YAClBC,EAAK,IAAIJ,OAAOK,kBAAkB,I,SAgBzBC,I,2EAAf,4BAAAC,EAAA,sEAC0BL,EAAgBM,WAAW,CAACC,MAAO,CAAC,YAD9D,cACUC,EADV,yBAGW,IAAIC,SAAQ,SAACC,EAAQC,GACxBC,UAAUC,mBAAmB,CACzBC,OAAO,EACPC,MAAO,CACHC,UAAW,CACPC,kBAAmB,UACnBC,oBAAqBV,EAAQ,GAAGW,GAChCC,SAAUtB,OAAOuB,OAAOC,MACxBC,UAAWzB,OAAOuB,OAAOG,WAGlC,SAACC,GACAf,EAAQe,MAET,SAACC,GAEAC,QAAQC,MAAMF,GACdf,EAAOe,UApBnB,4C,+BAwBeG,E,8EAAf,WAA4BC,GAA5B,eAAAzB,EAAA,sEAC0BD,IAD1B,cACK2B,EADL,gBAEQ7B,EAAG8B,UAAUD,GAFrB,uBAIQ7B,EAAG+B,qBAAqBH,GAJhC,mBAMQ5B,EANR,UAMqCA,EAAG2B,eANxC,0CAMWK,oBANX,+BAOCP,QAAQQ,IAAI,SAAUC,KAAKC,UAAUnC,EAAGoC,mBAPzC,kBAQSpC,EAAGoC,kBARZ,6C,sBAtCApC,EAAGqC,cAAgB,SAACC,GAChBb,QAAQQ,IAAI,cAAeK,GAC3BA,EAAEC,OAAOC,UAAY,SAACF,GAClB,MAAoBA,EAAEG,KAAfC,EAAP,EAAOA,KAAKD,EAAZ,EAAYA,KACA,UAATC,IACSD,EAAKtB,OAAS,CACVC,MAAOxB,OAAOuB,OAAOC,MACrBE,OAAO1B,OAAOuB,OAAOG,SAG7BG,QAAQQ,IAAIS,EAAK,MACjB3C,EAAY4C,KAAK,QAAQD,EAAKD,KA4C9CzC,EAAG4C,eAAiB,SAAUN,GAC1Bb,QAAQQ,IAAI,sBAAsBK,GAClCb,QAAQQ,IAAI,YAAaC,KAAKC,UAAUG,EAAEO,YACvCP,EAAEO,WACL9C,EAAY4C,KAAK,UAAU,mBAA3B,eAAmDL,EAAEO,aAIvD9C,EAAY+C,GAAG,aAAY,SAACR,EAAGO,I,oCAC3BE,CAAgBF,MAGpB,IAAIG,EAAa,G,4CACjB,WAA+BH,GAA/B,eAAA1C,EAAA,yDACQ0C,GACHG,EAAWC,KAAKJ,IAEd7C,EAAGkD,oBAAqBlD,EAAGkD,kBAAkBR,KAJpD,iBAKgBS,EAAE,EALlB,YAKoBA,EAAEH,EAAWI,QALjC,gCAMiBpD,EAAG+C,gBAAgB,IAAIM,gBAAgBL,EAAWG,KANnE,OAKyCA,IALzC,sBASQH,EAAa,GATrB,6C,sBAaFjD,EAAY+C,GAAG,QAAf,uCAAuB,WAAOR,EAAGV,GAAV,eAAAzB,EAAA,sEACFwB,EAAaC,GADX,OACjB0B,EADiB,OAErBvD,EAAY4C,KAAK,UAAU,SAAS,CAACD,KAAKY,EAAOZ,KAAMa,IAAID,EAAOC,MAF7C,2CAAvB,yD,WCpFOxD,EAAeH,OAAOC,QAAQ,YAA9BE,YACP0B,QAAQQ,IAAIrC,OAAOC,QAAQ,oBAAoB2D,MAC/C,MAAyB5D,OAAOC,QAAQ,oBAAjC4D,EAAP,EAAOA,SAAUD,EAAjB,EAAiBA,KAGjB/B,QAAQQ,IAAIlC,GAoFG2D,MAnFf,WAEE,MAAoCC,mBAAS,IAA7C,mBAAOC,EAAP,KAAmBC,EAAnB,KAEA,EAAmCF,mBAAS,IAA5C,mBAAOG,EAAP,KAAmBC,EAAnB,KAEA,EAAsCJ,mBAAS,IAA/C,mBAAOK,EAAP,KAAoBC,EAApB,KAEMC,EAAK,uCAAG,8BAAA/D,EAAA,sEACOJ,EAAYoE,OAAO,SAD1B,gBACPC,EADO,EACPA,KACL3C,QAAQQ,IAAI,OAAOmC,GACnBL,EAAaK,GAHD,2CAAH,qDAQXC,qBAAU,WAOR,OALAH,IAEAnE,EAAY+C,GAAG,uBAAwBwB,GAGhC,WACLvE,EAAYwE,eAAe,uBAAwBD,MAErD,IAMF,IAYMA,EAAqB,SAAChC,EAAGkC,EAAM9B,GACnCjB,QAAQQ,IAAI,sBACZ,IAAIwC,EAAO,GACD,IAAP/B,EAED+B,EAAI,kCAAUD,GACE,IAAR9B,IAER+B,EAAI,gBAAOD,EAAP,iBAENP,EAAeQ,IAWjB,OACE,qBAAKC,UAAU,MAAf,SAEoB,KAAhBV,EACE,qCACA,iEACE,sBAAMW,cAAe,SAAArC,IAdL,SAACA,GACzBA,EAAEsC,iBACF,IAAMC,EAAO,IAAIrB,EACjBqB,EAAKC,OAAO,IAAIrB,EAAS,CAACsB,MAAM,eAAKC,KAAK,UAC1CH,EAAKI,QAU4BC,CAAkB5C,IAA3C,SACCwB,OAGH,uBAAOpB,KAAK,OAAOyC,MAAOvB,EAAYwB,SAAU,SAAA9C,GAAC,OAAEuB,EAAcvB,EAAE+C,OAAOF,UAC1E,wBAAQG,QAAS,kBA5CJ,SAAC1B,GACpBnC,QAAQQ,IAAI2B,GAEZ7D,EAAY4C,KAAK,UAAUiB,GAyCA2B,CAAa3B,IAAlC,6BACI,8BAAMI,OC3ELwB,EAZS,SAAAC,GAClBA,GAAeA,aAAuBC,UACxC,6BAAqBC,MAAK,YAAkD,IAA/CC,EAA8C,EAA9CA,OAAQC,EAAsC,EAAtCA,OAAQC,EAA8B,EAA9BA,OAAQC,EAAsB,EAAtBA,OAAQC,EAAc,EAAdA,QAC3DJ,EAAOH,GACPI,EAAOJ,GACPK,EAAOL,GACPM,EAAON,GACPO,EAAQP,OCDdQ,IAASC,OACP,cAAC,IAAMC,WAAP,UACE,cAAC,EAAD,MAEFC,SAASC,eAAe,SAM1Bb,M","file":"static/js/main.11ff80be.chunk.js","sourcesContent":["// createAnswer\n// addstream\n\n\nconst { desktopCapturer,ipcRenderer } = window.require('electron')\nconst pc = new window.RTCPeerConnection({})\n\npc.ondatachannel = (e) =>{\n    console.log('datachannel', e);\n    e.chanel.onmessage = (e)=>{\n        const {type,data} = e.data\n        if(type === 'mouse') {\n                    data.screen = {\n                        width: window.screen.width,\n                        height:window.screen.height\n                    }\n                } \n                console.log(type,'on');\n                ipcRenderer.send('robot',type,data)\n    }\n}\nasync function getScreenStream() {\n    const sources = await desktopCapturer.getSources({types: ['screen']})\n\n    return new Promise((resolve,reject)=>{\n        navigator.webkitGetUserMedia({\n            audio: false,\n            video: {\n                mandatory: {\n                    chromeMediaSource: 'desktop',\n                    chromeMediaSourceId: sources[0].id,\n                    maxWidth: window.screen.width,\n                    maxHeight: window.screen.height\n                }\n            }\n        }, (stream) => {\n            resolve(stream)\n            // peer.emit('add-stream', stream)\n        }, (err) => {\n            //handle err\n            console.error(err)\n            reject(err)\n        })\n    })\n}\nasync function createAnswer(offer){\n let screenStream = await getScreenStream()\n  await pc.addStream(screenStream)\n  // 设置远端会话描述\n  await pc.setRemoteDescription(offer)\n // 设置本地会话描述\n  await pc.setLocalDescription(await pc.createAnswer())\n console.log('answer', JSON.stringify(pc.localDescription))\n  return pc.localDescription;\n}\n\n// window.createAnswer = createAnswer\n\n\n// onicecandidate iceEvent\n// addIceCandidate\n\npc.onicecandidate = function (e){\n    console.log('peer-onicecandidate',e);\n    console.log('candidate', JSON.stringify(e.candidate));\n    if(e.candidate) {\n    ipcRenderer.send('forward','puppet-candidate', {...e.candidate})\n}\n  }\n  \n  ipcRenderer.on('candidate',(e, candidate)=>{\n      addIceCandidate(candidate)\n  })\n  \n  let candidates = []\n  async function addIceCandidate(candidate) {\n      if (candidate) {\n       candidates.push(candidate)\n      }\n      if(pc.remoteDescription && pc.remoteDescription.type) {\n          for(let i=0;i<candidates.length ;i++) {\n            await  pc.addIceCandidate(new RTCIceCandidate(candidates[i]))\n          }\n  \n          candidates = []\n      }\n  }\n//window.addIceCandidate = addIceCandidate\nipcRenderer.on('offer',async (e, offer)=>{\n  let answer = await createAnswer(offer)\n  ipcRenderer.send('forward','answer',{type:answer.type, sdp:answer.sdp})\n})\n\n\n","import  {useState, useEffect} from 'react'\nimport './App.css';\nimport './peer-puppet.js'\n// import {ipcRenderer, remote} from 'electron'\nconst {ipcRenderer} = window.require('electron')\nconsole.log(window.require('@electron/remote').Menu);\nconst {MenuItem, Menu} = window.require('@electron/remote')\n// console.log(remote);\n// const {MenuItem, Menu} = remote\nconsole.log(ipcRenderer);\nfunction App() {\n  // 远端code\n  const [remoteCode, setRemoteCode] = useState('')\n  // 本地code\n  const [localCoade, setLocalCode] = useState('')\n  // 链接状态\n  const [controlText, setControlText] = useState('')\n  // 登录逻辑\n  const login = async ()=>{\n    let {code} = await ipcRenderer.invoke('login')\n    console.log('code',code);\n    setLocalCode(code)\n  }\n\n  // react hook\n  \n  useEffect(()=>{\n    // 相当于 componentDidMount 过程\n    login();\n    // 监听 状态码的变化\n    ipcRenderer.on('control-state-change', handleControlState)\n    // 清理监听\n    // 相当于 componentWillUnmount\n    return ()=>{\n      ipcRenderer.removeListener('control-state-change', handleControlState)\n    }\n  },[])\n\n  /**\n   * 开始控制\n   * @param {*} remoteCode \n   */\n  const startControl = (remoteCode) =>{\n    console.log(remoteCode);\n    // 向主进程发起远程控制\n    ipcRenderer.send('control',remoteCode)\n  }\n\n  /**\n   * 监听控制状态的修改\n   * @param {*} e \n   * @param {*} name \n   * @param {*} type \n   */\n  const handleControlState = (e, name, type) =>{\n    console.log('handleControlState');\n    let text = ''\n    if(type===1){\n      // 控制别人\n      text = `正在控制${name}`\n    } else if(type ===2) {\n      // 被控制\n      text = `被${name}控制`\n    }\n    setControlText(text)\n  }\n\n  const handleContextmenu = (e)=>{\n    e.preventDefault()\n    const menu = new Menu()\n    menu.append(new MenuItem({label:'复制',role:'copy'}))\n    menu.popup()\n  }\n\n\n  return (\n    <div className=\"App\">\n      {\n        controlText === ''?\n          <>\n          <div>您的控制码\n            <span onContextMenu={e=>{handleContextmenu(e)}}>\n            {localCoade}\n            </span>\n            </div>\n          <input type=\"text\" value={remoteCode} onChange={e=>setRemoteCode(e.target.value)}/>\n          <button onClick={()=>startControl(remoteCode)}>确认</button>\n          </>:<div>{controlText}</div>\n      }\n    </div>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}